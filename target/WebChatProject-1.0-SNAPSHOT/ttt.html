<!DOCTYPE html>
<html>
    <head>
        <title>Start Page</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <style>
        .collapsible {
          background-color: #777;
          color: white;
          cursor: pointer;
          padding: 18px;
          width: 100%;
          border: none;
          text-align: left;
          outline: none;
          font-size: 15px;
        }
        
        .active, .collapsible:hover {
          background-color: #555;
        }
        
        .collapsible:after {
          content: '\002B';
          color: white;
          font-weight: bold;
          float: right;
          margin-left: 5px;
        }
        
        .active:after {
          content: "\2212";
        }
        
        .content {
          padding: 0 18px;
          max-height: 0;
          visibility: hidden;
          transition: max-height 0.2s ease-out;
          background-color: #f1f1f1;
        }
    </style>
        <script type="text/javascript">
            var listSocketConnected = new Map();
            var roomName;
            var address;
            var websocket;
            function startChat(name)
            {
            roomName = name;
            
            websocket = listSocketConnected.get(roomName);
            messagesTextArea.value = "";
            if(websocket == undefined)  
            {
                address = "ws://localhost:8080/WebChatProject/chatroomEndpoint/" + roomName;
                websocket = new WebSocket(address);
                listSocketConnected.set(roomName, websocket);
            }
            
            websocket.onmessage = function processMessage(message)
            {
                var jsonData = JSON.parse(message.data);
                if (jsonData.message !== null) 
                    messagesTextArea.value += jsonData.message + "\n";
            };
        }
            function sendMessage()
            {
                websocket.send(messageText.value);
                messageText.value = "";
                  
            }
        </script>
    </head>
    <body>
        <h1>Hello World!</h1>
        <br>
        <button class="collapsible">Open Collapsible</button>
    <div class="content">
        <button>Add Room</button>
        <textarea rows="1" cols="20" maxlength="20" id="roomName"></textarea>
       <br>
       <button>Add Friend</button>
       <button id="buttonAdd">Add</button>
    </div>
        <br>
        <span id="checkCreate"></span>
        <br>
        <div id="list-room">
            <button name="2" onclick="startChat(this.name)">Room 2</button>
            <button name="3" onclick="startChat(this.name)">Room 3</button>
        </div>

        <br>
        <textarea id="messagesTextArea" readonly="readonly" rows="10" cols="50"></textarea>
        <input type="text" id="messageText" size="50">
        <input type="button" value="Send" onclick="sendMessage();">
        <br>
        <div id="check"></div>
        <a href="login?action=Logout">Logout</a>
        <script>
        var coll = document.getElementsByClassName("collapsible");
        var i;
        
        for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight){
              content.style.maxHeight = null;
              content.style.visibility = 'hidden';
            } else {
              content.style.maxHeight = content.scrollHeight + "px";
              content.style.visibility = 'visible';
            } 
          });
        }
        </script>
        <script>
            $(document).ready(function(){
                $('#buttonAdd').click(function(){
                    var roomName = $('#roomName').val();
                    $.ajax({
                        type: 'get',
                        data: {roomName: roomName},
                        url: 'createNewRoom',
                        success: function(result){
                            $('#checkCreate').html(result);
                            $('#list-room').append("<button name=\""+ result + "\" onclick=\"startChat(this.name)\">"+ roomName + "</button>");
                        }
                    });
                });
            });
        </script>
    </body>
</html>
